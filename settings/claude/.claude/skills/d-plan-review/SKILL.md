---
name: d-plan-review
description: "Plan確認 - 要望を分析しタスク分解・概要・完了条件を自動記載"
user-invocable: true
disable-model-invocation: false
allowed-tools: Read, Edit, Bash, Glob
---

# Plan確認

ユーザーが記載した要望・要件を分析し、planファイルを整理する。

## 使用場面

Claudeは以下の状況で**自動的にこのスキルを適用**する：

- 「plan確認して」「planを整理して」と言われた時

また、`/d-plan-review` で手動呼び出しも可能。

## 前提

- `d-plan-create` で作成されたplanファイルが存在する
- ユーザーが「要望・要件」セクションを記載済み

## 実行フロー

### Step 1: planファイル読み込み

- 直前に作成した、または指定されたplan.mdを読み込む
- 不明な場合は active/ をGlobで確認し、最新のplanを使用
  - Glob: `~/.dotfiles/desk/plans/active/*.md`

### Step 2: 要望・要件の分析

- 「## 要望・要件」セクションの内容を読み取る
- 実装内容を理解する
- 検討事項がある場合は「## 実装メモ」セクションに追記する

### Step 3: ファイル名の変更

- 要望内容から適切な機能名を抽出
- **ユーザー確認なしで自動的にファイル名変更を実行**
- Bash: `mv` コマンドで旧ファイル名 → 新ファイル名

### Step 4: ブランチ名の記載（bugfix/featureのみ）

- テンプレートがbugfixまたはfeatureの場合のみ実施
- Edit: `## ブランチ名` セクションに記載
  - bugfix → `fix/簡潔な英語名`（例: `fix/tool-image-api-error`）
  - feature → `feature/簡潔な英語名`（例: `feature/tool-list-url`）
- investigationの場合はスキップ

### Step 5: 概要セクションの記載

- Edit: `## 概要` セクションに要望から要約した1-2文の概要を記載

### Step 6: 対応状況セクションのタスク追加

- Edit: `## 対応状況` セクションにタスクを追加
- テンプレートの対応状況が既にある場合は、要望に合わせて調整・追加する
- 必要に応じてタスクの追加・削除・並べ替えを行う

### Step 7: 完了条件セクションの記載

- Edit: `## 完了条件` セクションを記載
- 要望に応じて適切な条件を設定する
- 基本形:
  ```markdown
  ## 完了条件
  - すべてのチェックボックスが完了
  - すべてのテストがパス
  ```
- プロジェクトにフォーマッタ等がある場合はCLAUDE.mdを参照して条件を追加

### Step 8: 修正内容の報告

ユーザーに以下を報告する：
- ファイル名変更: 旧 → 新
- ブランチ名: 記載した内容（bugfix/featureの場合）
- 概要: 記載した内容
- 対応状況: 追加したチェックボックス数
- 完了条件: 記載した内容

### Step 9: 次のステップ案内

- 「以降は `/d-plan-implement` フローで1つずつ実装します」
- 「最初のタスクに進みますか？」

## 重要ルール

- planファイルパス: `~/.dotfiles/desk/plans/`
- **planファイルは必ず日本語で記載する**（概要・対応状況・完了条件すべて）
- **簡潔に書く**。冗長な説明は不要。箇条書き中心で要点だけ
