# バージョンマネージャをmiseに統一

**ステータス**: 承認済み
**日付**: 2026-02-20

---

## コンテキスト（Context）

開発環境のランタイムバージョン管理に3つのツールを併用していた。

| ツール | 管理対象 | 問題点 |
|--------|---------|--------|
| anyenv | jenv, goenv, sbtenv, scalaenv | メンテ停滞気味。jenvとSDKMANでJavaが二重管理 |
| volta | Node.js, yarn, グローバルnpmパッケージ | Node.js特化で他言語を管理できない |
| SDKMAN | Java, sbt | JVM系特化。.zshrcの初期化が重い |

- .zshrcに3ツール分の初期化コード（15行）が必要で肥大化
- ツール間でJavaが二重管理される不整合
- 新しいマシンのセットアップで3ツールそれぞれの設定が必要

---

## 決定（Decision）

**miseに一元化する。** yarn管理もmiseのnpmバックエンドで統一。sbtはHomebrew管理とする。

| ツール | 管理対象 | 備考 |
|--------|---------|------|
| mise | Java, Node.js, yarn, safe-chain | 全言語・ツールを一元管理 |
| Homebrew | sbt | ランチャーのみ。プロジェクト版はbuild.properties |

---

## 選択肢（Options）

### 選択肢1: mise（採用）
- **メリット**:
  - Rust製で高速（PATH方式、asdfのshim方式より速い）
  - .tool-versions（asdf互換）と.sdkmanrc互換あり
  - npmバックエンドでグローバルパッケージも管理可能
  - config.tomlをdotfilesで管理でき、新環境構築が `mise install` 一発
- **デメリット**:
  - 2022年登場で比較的新しい（ただし急速に普及中）

### 選択肢2: asdf
- **メリット**:
  - バージョンマネージャの定番。プラグインエコシステムが成熟
  - .tool-versionsがデファクトスタンダード
- **デメリット**:
  - shim方式でmiseより遅い
  - プラグインを別途インストールする必要がある
  - 環境変数管理やタスク機能がない

### 選択肢3: 現状維持（anyenv + volta + SDKMAN）
- **メリット**:
  - 既に動作しており移行コスト不要
- **デメリット**:
  - 3ツール管理の複雑さは解消されない
  - anyenvのメンテ停滞は今後悪化する可能性

---

## 根拠（Rationale）

- miseはasdfの上位互換として急速に普及しており、asdfからの移行がトレンドになっている
- .sdkmanrc互換があるため、既存のJavaプロジェクト設定をそのまま使える
- npmバックエンドにより、Corepack（Node.js 25で同梱廃止）に依存せずyarnを管理可能
- config.tomlをstowでdotfiles管理することで、環境構築の完全自動化が実現

---

## 結果（Consequences）

### ポジティブな影響
- .zshrcが15行→3行に簡素化（`eval "$(mise activate zsh)"` のみ）
- Java二重管理の解消
- 新環境セットアップが `brew install mise && mise install` で完結
- グローバルバージョン設定がgit管理され、変更履歴が追える

### ネガティブな影響
- voltaのグローバルnpmパッケージ（codex, tsx, zx等）は必要に応じて再インストールが必要
- 既存の.sdkmanrcを使うプロジェクトでの動作確認が必要

### リスク
- miseの開発が停滞した場合、asdfへの移行が必要（ただし.tool-versions互換のためリスクは低い）

---

## 参考資料（References）

- [mise公式ドキュメント](https://mise.jdx.dev/)
- [Comparison to asdf | mise-en-place](https://mise.jdx.dev/dev-tools/comparison-to-asdf.html)
- [npm Backend | mise-en-place](https://mise.jdx.dev/dev-tools/backends/npm.html)
- [Node.js TSC Votes to Stop Distributing Corepack](https://socket.dev/blog/node-js-tsc-votes-to-stop-distributing-corepack)

---

## メモ

- Ruby, Go: 現在使用していないためmise管理対象外。必要時に `mise use` で追加可能
- direnv: miseの`[env]`で代替可能だが、既存.envrcとの互換のため当面共存
- Scala: sbt経由で自動DLされるためバージョンマネージャ管理不要
